import{o as e,a as t,w as n,g as s,d as l,f as c,t as o,j as i,k as a,F as u,Q as r,R as d,T as p,i as h,U as m,D as f,V as _}from"./index-fc227ea0.js";import{a as b}from"./mqtt.04868d09.js";import{_ as g}from"./_plugin-vue_export-helper.1b428a4d.js";const v=g({computed:{uri(){const{protocol:e,host:t,port:n,endpoint:s}=this.connection;return`${e}://${t}:${n}${s}`}},data:()=>({connection:{protocol:"ws",port:8083,host:"jqrjq.cn",endpoint:"/mqtt",clean:!0,connectTimeout:3e4,reconnectPeriod:4e3,clientId:"emqx_vue_"+Math.random().toString(16).substring(2,8),username:"emqx_test",password:"emqx_test",keep_alive:60},subscription:{topic:"topic/mqttx",qos:0},publish:{topic:"topic/browser",qos:0,payload:'{ "msg": "Hello, I am browser." }'},receiveNews:"",qosList:[0,1,2],client:{connected:!1},subscribeSuccess:!1,connecting:!1,retryTimes:0,ssl:!1,connected:!1,msgs:[]}),methods:{initData(){this.client={connected:!1},this.retryTimes=0,this.connecting=!1,this.subscribeSuccess=!1},handleOnReConnect(){if(this.retryTimes+=1,this.retryTimes>5)try{this.client.end(),this.initData(),this.$message.error("Connection maxReconnectTimes limit, stop retry")}catch(e){this.$message.error(e.toString())}},createConnection(){try{this.connecting=!0;const{protocol:e,host:t,port:n,endpoint:s,...l}=this.connection,c=`${e}://${t}:${n}${s}`;this.client=b.connect(c,l),this.client.on&&(this.client.on("connect",(()=>{this.connecting=!1,this.connected=!0,console.log("Connection succeeded!")})),this.client.on("reconnect",this.handleOnReConnect),this.client.on("error",(e=>{console.log("Connection failed",e)})),this.client.on("message",((e,t)=>{this.receiveNews=this.receiveNews.concat(t);const n=JSON.parse(t);this.msgs.push(n)})))}catch(e){this.connecting=!1,console.log("mqtt.connect error",e)}},destroyConnection(){if(this.client.connected)try{this.client.end(!1,(()=>{this.initData(),this.connected=!1,console.log("Successfully disconnected!")}))}catch(e){console.log("Disconnect failed",e.toString())}},doSubscribe(){const{topic:e,qos:t}=this.subscription;this.client.subscribe(e,{qos:t},((e,t)=>{e?console.log("Subscribe to topics error",e):(this.subscribeSuccess=!0,console.log("Subscribe to topics res",t))}))},doUnSubscribe(){const{topic:e}=this.subscription;this.client.unsubscribe(e,(e=>{e&&console.log("Unsubscribe error",e)}))},doPublish(){const{topic:e,qos:t,payload:n}=this.publish;this.client.publish(e,n,{qos:t},(e=>{e&&console.log("Publish error",e)}))},changeUrl:function(e){const{value:t}=e.detail;t.forEach((e=>{this.connection.port="SSL"==e?8084:8083,this.connection.protocol="SSL"==e?"wss":"ws"}))}}},[["render",function(b,g,v,y,S,C){const k=s,q=r,w=d,x=p,$=h,j=m,D=f;return e(),t(k,{class:"container"},{default:n((()=>[l(k,{class:"uni-common-mt"},{default:n((()=>[l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("地址")])),_:1}),l(q,{class:"uni-input",placeholder:"输入地址",value:S.connection.host},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("端口")])),_:1}),l(q,{class:"uni-input",placeholder:"输入端口",value:S.connection.port},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("路径")])),_:1}),l(q,{class:"uni-input",placeholder:"输入路径",value:S.connection.endpoint},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("客户端ID")])),_:1}),l(q,{class:"uni-input",placeholder:"输入客户端ID(可选)",value:S.connection.clientId},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("用户名")])),_:1}),l(q,{class:"uni-input",placeholder:"输入用户名(可选)",value:S.connection.username},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("密码")])),_:1}),l(q,{class:"uni-input",placeholder:"输入密码(可选)",value:S.connection.password},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("存活时间")])),_:1}),l(q,{class:"uni-input",placeholder:"输入存活时间(默认60)",value:S.connection.keep_alive},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("订阅主题")])),_:1}),l(q,{class:"uni-input",placeholder:"输入需要订阅的主题",value:S.subscription.topic},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("发布主题")])),_:1}),l(q,{class:"uni-input",placeholder:"输入需要发布到的主题",value:S.publish.topic},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"},{default:n((()=>[c("发布内容")])),_:1}),l(q,{class:"uni-input",placeholder:"输入需要发布的内容(常为json)",value:S.publish.payload},null,8,["value"])])),_:1}),l(k,{class:"uni-form-item uni-column"},{default:n((()=>[l(k,{class:"title"}),l(j,{class:"cbox",onChange:C.changeUrl},{default:n((()=>[l(k,null,{default:n((()=>[l(x,{class:"cbox-label"},{default:n((()=>[l(w,{value:"CleanSession",checked:"true"}),c("清除会话 ")])),_:1}),l(x,{class:"cbox-label"},{default:n((()=>[l(w,{value:"SSL"}),c("SSL ")])),_:1})])),_:1}),l(k,null,{default:n((()=>[l(x,null,{default:n((()=>[l($,{class:"uri-text"},{default:n((()=>[c(o(C.uri),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["onChange"])])),_:1}),l(k,{class:"btn-group"},{default:n((()=>[S.connected?(e(),t(D,{key:1,class:"btn-conn",type:"default",disabled:""},{default:n((()=>[c("连接")])),_:1})):(e(),t(D,{key:0,onClick:C.createConnection,class:"btn-conn",type:"default"},{default:n((()=>[c("连接")])),_:1},8,["onClick"])),l(D,{onClick:C.destroyConnection,type:"warn"},{default:n((()=>[c("断开连接")])),_:1},8,["onClick"]),l(k,{class:"state-text"},{default:n((()=>[l($,null,{default:n((()=>[c("当前状态:")])),_:1}),S.connected?(e(),t($,{key:1,style:{color:"rgb(66, 216, 133)"}},{default:n((()=>[c("已连接")])),_:1})):(e(),t($,{key:0,style:{color:"rgb(255, 109, 109)"}},{default:n((()=>[c("未连接")])),_:1}))])),_:1})])),_:1}),l(k,{class:"btn-group"},{default:n((()=>[l(D,{onClick:C.doSubscribe,type:"primary"},{default:n((()=>[c("订阅主题")])),_:1},8,["onClick"]),l(D,{onClick:C.doUnSubscribe,type:"warn"},{default:n((()=>[c("取消订阅")])),_:1},8,["onClick"]),l(D,{disabled:""})])),_:1}),l(k,{class:"msg_list"},{default:n((()=>[l($,null,{default:n((()=>[c("消息列表")])),_:1}),(e(!0),i(u,null,a(S.msgs,((t,n)=>(e(),i("p",null,[c(o(t.name)+"："+o(t.msg)+" ",1),_("hr")])))),256))])),_:1})])),_:1})])),_:1})}],["__scopeId","data-v-bfbc170b"]]);export{v as default};
