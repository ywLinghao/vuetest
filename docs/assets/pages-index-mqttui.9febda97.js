import{y as e,z as l,O as t,o as a,a as o,w as n,g as s,d as u,f as c,t as d,e as r,i as v,Q as i,Z as p,_ as m,E as _}from"./index-3809deb0.js";import{m as f}from"./mqtt.d6b2f96e.js";import{_ as g}from"./_plugin-vue_export-helper.1b428a4d.js";const h=g({__name:"mqttui",setup(g){let h=e({connected:!1});const C=e("");e(!1);const y=e(""),S=e(0),x=e(["CleanSession","SSL"]),V=e(""),w=e(!1),E=e(!0);var b,D=e(0);let I="";I="ws",D.value=1;const N=e=>{const l=e.detail.value;console.log("selected.value:",x.value),l.includes("SSL")?q():O(),l.includes("CleanSession")?T():U()},q=()=>{1===D.value?j.protocol="wss":2===D.value&&(j.protocol="wxs")},O=()=>{1===D.value?j.protocol="ws":2===D.value&&(j.protocol="wx")},T=()=>{j.clean=!0},U=()=>{j.clean=!1},$=()=>{1==D.value?(b=document.getElementById("statetext"))&&(b.style.color="red"):2==D.value&&(V.value="color: red;")},j=l({protocol:"ws",host:"jqrjq.cn",port:8083,path:"/mqtt",clientId:"emqx_vue3_"+Math.random().toString(16).substring(2,8),username:"",password:"",state:e("DISCONNECTED"),clean:!0,connectTimeout:3e4,reconnectPeriod:4e3}),L=()=>{if(S.value+=1,S.value>5)try{h.value.end(),initData(),console.log("connection maxReconnectTimes limit, stop retry")}catch(e){console.log("handleOnReConnect catch error:",e),w.value=!1}},P=()=>{j.state="CONNECTING",w.value=!0;try{const{protocol:e,host:l,port:t,path:a,...o}=j,n=`${e}://${l}:${t}${a}`;h.value=f.connect(n,o),h.value.on&&(h.value.on("connect",(()=>{y.value="",j.state="CONNECTED",1==D.value?(b=document.getElementById("statetext"))&&(b.style.color="green"):2==D.value&&(V.value="color: green;"),console.log("connection successful"),E.value=!1})),h.value.on("reconnect",L),h.value.on("error",(e=>{console.log("connection error:",e)})),h.value.on("message",((e,l)=>{C.value=C.value.concat(l.toString()),console.log(`received message: ${l} from topic: ${e}`)})))}catch(e){console.log("mqtt.connect error:",e),w.value=!1,E.value=!0}};t((()=>{$()}));const k=()=>{console.log("连接中..."),P()},B=()=>{if(h.value.connected)try{h.value.end(),j.state="DISCONNECTED",$(),console.log("Disconnected"),w.value=!1,E.value=!0}catch(e){console.log("Error disconnecting:",e)}else console.log("没有活动连接可断开")};return(e,l)=>{const t=s,f=v,g=i,h=p,C=m,y=_;return a(),o(t,{class:"view"},{default:n((()=>[u(t,{class:"title"},{default:n((()=>[c("Connect")])),_:1}),u(f,null,{default:n((()=>[c("Host")])),_:1}),u(g,{type:"text",modelValue:j.host,"onUpdate:modelValue":l[0]||(l[0]=e=>j.host=e)},null,8,["modelValue"]),u(f,null,{default:n((()=>[c("Port")])),_:1}),u(g,{type:"text",modelValue:j.port,"onUpdate:modelValue":l[1]||(l[1]=e=>j.port=e)},null,8,["modelValue"]),u(f,null,{default:n((()=>[c("Path")])),_:1}),u(g,{type:"text",modelValue:j.path,"onUpdate:modelValue":l[2]||(l[2]=e=>j.path=e)},null,8,["modelValue"]),u(f,null,{default:n((()=>[c("Client ID")])),_:1}),u(g,{type:"text",value:j.clientId,disabled:""},null,8,["value"]),u(f,null,{default:n((()=>[c("Username")])),_:1}),u(g,{type:"text",modelValue:j.username,"onUpdate:modelValue":l[3]||(l[3]=e=>j.username=e)},null,8,["modelValue"]),u(f,null,{default:n((()=>[c("Password")])),_:1}),u(g,{type:"password",modelValue:j.password,"onUpdate:modelValue":l[4]||(l[4]=e=>j.password=e)},null,8,["modelValue"]),u(f,null,{default:n((()=>[c("Keep Alive")])),_:1}),u(g,{type:"text",value:"60"}),u(t,null,{default:n((()=>[u(C,{values:x.value,onChange:N},{default:n((()=>[u(h,{value:"CleanSession",checked:""},{default:n((()=>[c("Clean Session ")])),_:1}),u(h,{value:"SSL"},{default:n((()=>[c("SSL")])),_:1})])),_:1},8,["values"]),u(f,{class:"url"},{default:n((()=>[c(d(j.protocol)+"://"+d(j.host)+":"+d(j.port)+d(j.path),1)])),_:1})])),_:1}),u(t,{class:"btn"},{default:n((()=>[u(y,{class:"btn1",onClick:k,disabled:w.value},{default:n((()=>[c("Connect")])),_:1},8,["disabled"]),u(y,{class:"btn2",onClick:B,disabled:E.value},{default:n((()=>[c("Disconnect")])),_:1},8,["disabled"])])),_:1}),u(f,{class:"state"},{default:n((()=>[c("Current State: "),u(f,{id:"statetext",style:r(V.value)},{default:n((()=>[c(d(j.state),1)])),_:1},8,["style"])])),_:1})])),_:1})}}},[["__scopeId","data-v-42ba93a4"]]);export{h as default};
